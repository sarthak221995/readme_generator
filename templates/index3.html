<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CrewAI README Generator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.9.4/css/bulma.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
        }
        .navbar {
            background: #fff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            padding: 1rem 2rem;
            border-radius: 0 0 16px 16px;
            margin-bottom: 2rem;
        }
        .navbar-brand .logo {
            font-weight: 700;
            font-size: 1.5rem;
            color: #4f46e5;
            letter-spacing: 1px;
        }
        .container {
            max-width: 600px;
            margin: 2rem auto;
        }
        .card {
            border-radius: 18px;
            box-shadow: 0 4px 24px rgba(80, 72, 229, 0.08);
            padding: 2.5rem 2rem 2rem 2rem;
            background: #fff;
        }
        .title {
            color: #4f46e5;
            font-weight: 700;
            margin-bottom: 1.5rem;
        }
        .button.is-primary {
            background: linear-gradient(90deg, #6366f1 0%, #4f46e5 100%);
            border: none;
            font-weight: 600;
            border-radius: 8px;
            font-size: 1.1rem;
        }
        .button.is-primary:hover {
            background: linear-gradient(90deg, #4f46e5 0%, #6366f1 100%);
        }
        .loader {
            border: 6px solid #f3f3f3;
            border-top: 6px solid #6366f1;
            border-radius: 50%;
            width: 48px;
            height: 48px;
            animation: spin 1s linear infinite;
            margin: 1.5rem auto 1rem auto;
            display: block;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .progress-message {
            color: #6366f1;
            font-weight: 500;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }
        .markdown-body {
            background: #f9fafb;
            padding: 2rem;
            border-radius: 12px;
            font-size: 1.05rem;
            box-shadow: 0 2px 8px rgba(80, 72, 229, 0.04);
        }
        .footer {
            text-align: center;
            color: #888;
            margin-top: 3rem;
            font-size: 0.95rem;
        }
        .download-btn {
            margin-top: 1.5rem;
            border-radius: 8px;
            font-weight: 600;
        }
    </style>
</head>
<body>
<nav class="navbar">
    <div class="navbar-brand">
        <span class="logo">CrewAI README Generator</span>
    </div>
</nav>
<div class="container">
    <div class="card">
        <h1 class="title has-text-centered">Generate a Beautiful README</h1>
        <form id="readme-form">
            <div class="field">
                <label class="label">GitHub Repository URL</label>
                <div class="control">
                    <input class="input" type="url" name="repo_url" id="repo_url" placeholder="https://github.com/owner/repo" required>
                </div>
            </div>
            <div class="field is-grouped is-grouped-centered" style="justify-content:center;">
                <div class="control">
                    <button class="button is-primary" type="submit">Generate README</button>
                </div>
            </div>
        </form>
        <div id="progress-section" style="display:none; text-align:center;">
            <div class="loader"></div>
            <p id="progress-message" class="progress-message">Analyzing repository structure...</p>
        </div>
        <div id="result-section" style="display:none;">
            <div class="box" style="box-shadow:none;">
                <article class="markdown-body" id="markdown-preview"></article>
            </div>
            <a id="download-btn" class="button is-link download-btn" href="#" download="README.md">Download README.md</a>
        </div>
    </div>
</div>
<footer class="footer">
    &copy; 2025 CrewAI SaaS &mdash; <a href="https://github.com/sarthak221995/Multi-Agent-Systems-with-CrewAI" target="_blank">GitHub</a>
</footer>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/markdown-it/dist/markdown-it.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.5/dist/purify.min.js"></script>
<script>
const form = document.getElementById('readme-form');
const progressSection = document.getElementById('progress-section');
const resultSection = document.getElementById('result-section');
const markdownPreview = document.getElementById('markdown-preview');
const downloadBtn = document.getElementById('download-btn');
const progressMsg = document.getElementById('progress-message');
let currentTaskId = null;
const md = window.markdownit();
const progressMessages = [
    "Analyzing repository structure...",
    "Fetching code and configuration...",
    "Generating README with AI agents...",
    "Reviewing and polishing documentation...",
    "Almost done! Finalizing output..."
];
let progressMsgIdx = 0;
let progressMsgInterval = null;

function startProgressMessages() {
    progressMsgIdx = 0;
    progressMsg.textContent = progressMessages[progressMsgIdx];
    progressMsgInterval = setInterval(() => {
        progressMsgIdx = (progressMsgIdx + 1) % progressMessages.length;
        progressMsg.textContent = progressMessages[progressMsgIdx];
    }, 2500);
}
function stopProgressMessages() {
    clearInterval(progressMsgInterval);
}

form.addEventListener('submit', function(e) {
    e.preventDefault();
    const repoUrl = document.getElementById('repo_url').value;
    progressSection.style.display = 'block';
    resultSection.style.display = 'none';
    markdownPreview.innerHTML = '';
    downloadBtn.style.display = 'none';
    startProgressMessages();
    fetch('/generate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: 'repo_url=' + encodeURIComponent(repoUrl)
    })
    .then(res => {
        if (!res.ok) throw new Error('Network response was not ok');
        return res.json();
    })
    .then(data => {
        if (data.task_id) {
            currentTaskId = data.task_id;
            pollProgress();
        } else {
            progressSection.style.display = 'none';
            stopProgressMessages();
            alert(data.error || 'Unknown error');
        }
    })
    .catch(err => {
        progressSection.style.display = 'none';
        stopProgressMessages();
        alert('Failed to contact backend: ' + err.message);
    });
});

function pollProgress() {
    fetch('/progress/' + currentTaskId)
        .then(res => res.json())
        .then(data => {
            if (data.status === 'running') {
                setTimeout(pollProgress, 1500);
            } else if (data.status === 'done') {
                progressSection.style.display = 'none';
                stopProgressMessages();
                resultSection.style.display = 'block';
                // Render markdown as HTML
                const rawHtml = md.render(data.output);
                const cleanHtml = DOMPurify.sanitize(rawHtml);
                markdownPreview.innerHTML = cleanHtml;
                downloadBtn.href = '/download/' + currentTaskId;
                downloadBtn.style.display = 'inline-block';
            } else {
                progressSection.style.display = 'none';
                stopProgressMessages();
                alert(data.output || 'An error occurred.');
            }
        });
}
</script>
</body>
</html>
